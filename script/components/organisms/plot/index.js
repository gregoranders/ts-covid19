import v,{memo as C}from"react";import{useRecoilState as D}from"recoil";import{ModelPropTypes as K}from"model";import{ComposedChart as U,XAxis as X,YAxis as Y,CartesianGrid as $,Bar as Q,Line as W,ResponsiveContainer as Z,Tooltip as ee,Legend as te}from"recharts";import{default as ae}from"states/avrg";import{default as re}from"states/type";const I=e=>e.toLocaleString();export const Plot=({model:e})=>{const[t,a]=D(re),[r,o]=D(ae),l=e=>new Date(e).toUTCString().replace(/\s00:.*/,""),n=e.values.filter(e=>e[t]>0).map(e=>({value:e[t],diff:e.diff[t],avrg:e.avrg[r][t],timestamp:e.timestamp})),m=["auto",1.2*n[n.length-1].value],i=["auto",1.2*n[n.length-1].diff],s=[n[0].timestamp-1296e5,n[n.length-1].timestamp+1296e5];return v.createElement("div",{className:"plot"},v.createElement("div",{className:"actions"},v.createElement("div",null),v.createElement("label",{htmlFor:"plotType"},"Type"),v.createElement("select",{id:"plotType",onChange:e=>{a(e.target.value)},value:t},v.createElement("option",{value:"confirmed"},"Confirmed"),v.createElement("option",{value:"dead"},"Deaths"),v.createElement("option",{value:"recovered"},"Recovered"),v.createElement("option",{value:"active"},"Active")),v.createElement("label",{htmlFor:"plotAvrg"},"Average"),v.createElement("select",{id:"plotAvrg",onChange:e=>{o(parseInt(e.target.value))},value:r},v.createElement("option",{value:"5"},"5"),v.createElement("option",{value:"7"},"7"),v.createElement("option",{value:"14"},"14"),v.createElement("option",{value:"21"},"21"),v.createElement("option",{value:"28"},"28"))),v.createElement(Z,{aspect:21/9},v.createElement(U,{data:n,margin:{top:5,right:50,left:50,bottom:5}},v.createElement($,{stroke:"#eee",strokeDasharray:"3 3"}),v.createElement(X,{type:"number",name:"Date",dataKey:"timestamp",scale:"time",domain:s,minTickGap:30,tickFormatter:l}),v.createElement(Y,{yAxisId:"log",scale:"log",orientation:"left",domain:m,tickFormatter:I}),v.createElement(Y,{yAxisId:"linear",scale:"linear",orientation:"right",hide:!0,tickFormatter:I}),v.createElement(Y,{yAxisId:"diff",scale:"sequential",orientation:"left",domain:i,mirror:!0,tickFormatter:I}),v.createElement(W,{name:"Logarithmic",yAxisId:"log",type:"monotone",dataKey:"value",stroke:"#888",dot:!1}),v.createElement(W,{name:"Linear",yAxisId:"linear",type:"monotone",dataKey:"value",stroke:"#888",dot:!1}),v.createElement(W,{name:`Average (${r} days)`,yAxisId:"diff",type:"monotone",dataKey:"avrg",stroke:"#bbb",strokeDasharray:"5 5",dot:!1}),v.createElement(Q,{name:"Daily",barSize:2,yAxisId:"diff",dataKey:"diff",stroke:"#bbb"}),v.createElement(ee,{labelFormatter:e=>v.createElement("h3",null,l(e)),formatter:e=>v.createElement(v.Fragment,null,I(e))}),v.createElement(te,null))))};Plot.displayName="Plot",Plot.propTypes={model:K};export default C(Plot);