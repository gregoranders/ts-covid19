const DefaultConfiguration={undefined:!1,fieldSeparator:",",lineSeparator:"\n",quote:'"'},fieldValue=(cell,options)=>{if(!options.undefined||cell.length)return cell},addField=(field,row,state)=>{row.push(field),state.field++,state.fieldOffset=-1,state.appendField=!1},addRow=(row,rows,state)=>{rows.push(row),state.field=0,state.line++,state.lineOffset=-1,state.appendRow=!1},csv2json=(text,configuration=DefaultConfiguration)=>new Promise(resolve=>{((text,configuration=DefaultConfiguration)=>{const options=Object.assign({},DefaultConfiguration,configuration),state={field:0,fieldOffset:0,line:0,lineOffset:0,quoted:!1,appendCell:!1,appendField:!1,appendRow:!1};return new Promise((resolve,reject)=>{if(text.length){const rows=[];let row=[],cell="";for(let idx=0;idx<text.length;idx++)state.appendCell=!0,text[idx]===options.quote?idx&&"\\"!==text[idx-1]?(!cell.length||state.quoted?state.quoted=!state.quoted:reject(Error(`Invalid CSV text at offset ${state.line}:${state.lineOffset}`)),state.appendCell=!1):cell=cell.substr(0,cell.length-1):text[idx]===options.fieldSeparator?state.quoted||(state.appendCell=!1,state.appendField=!0):text[idx]===options.lineSeparator&&(state.quoted||(state.appendCell=!1,state.appendField=!0,state.appendRow=!0)),state.appendCell&&(cell+=text[idx]),state.appendField&&(addField(fieldValue(cell,options),row,state),cell=""),state.appendRow&&(addRow(row,rows,state),row=[]),state.lineOffset++,state.fieldOffset++;row.length&&(addField(fieldValue(cell,options),row,state),addRow(row,rows,state)),resolve(rows)}else reject(Error("Empty CSV text"))})})(text,configuration).then(rows=>{const keys=rows[0].filter(field=>"string"==typeof field);resolve(rows.filter((row,idx)=>idx>0).map(row=>{const obj={};return keys.forEach((key,keyIdx)=>{obj[key]=row[keyIdx]}),obj}))})});class ModelMapper{map(rows){return rows.map(row=>this._map(row)).sort((a,b)=>{const diff=a.country.localeCompare(b.country);return 0===diff?a.state.localeCompare(b.state):diff})}_map(row){const temp={values:[]};return Object.keys(row).forEach(key=>{if(key.match(/State/))temp.state=row[key];else if(key.match(/Country/))temp.country=row[key].replace(/\*/,"");else if(key.match(/Lat/))temp.lat=parseFloat(row[key]);else if(key.match(/Long/))temp.lon=parseFloat(row[key]);else{const value=parseInt(row[key],10),date=new Date(key),timestamp=Date.UTC(date.getFullYear(),date.getMonth(),date.getDate());temp.values.push({timestamp,value})}}),temp.values.sort((a,b)=>a.timestamp-b.timestamp),Object.freeze(temp)}}class LookupMapper{map(rows){return rows.map(row=>this._map(row)).sort((a,b)=>{const diff=a.country.localeCompare(b.country);return 0===diff?a.state.localeCompare(b.state):diff})}_map(row){const temp={};return Object.keys(row).forEach(key=>{key.match(/State/)?temp.state=row[key]:key.match(/Country/)?temp.country=row[key].replace(/\*/,""):key.match(/Lat/)?temp.lat=parseFloat(row[key]):key.match(/Long/)?temp.lon=parseFloat(row[key]):key.match(/Population/)?temp.population=parseInt(row[key]):key.match(/UID/)?temp.uid=parseInt(row[key]):key.match(/iso2/)?temp.iso2=row[key]:key.match(/iso3/)?temp.iso3=row[key]:key.match(/code3/)?temp.code3=parseInt(row[key]):key.match(/FIPS/)?temp.fips=parseInt(row[key]):key.match(/Admin2/)&&(temp.admin2=row[key])}),Object.freeze(temp)}}var Type;!function(Type){Type.CONFIRMED="confirmed",Type.DEATHS="deaths",Type.RECOVERED="recovered",Type.LOOKUP="lookup"}(Type||(Type={}));class ModelCollector{constructor(_modelMapper=new ModelMapper,_lookupMapper=new LookupMapper){this._modelMapper=_modelMapper,this._lookupMapper=_lookupMapper}async collect(){const lookup=await this._fetchLookup(),confirmed=await this._fetchModel(Type.CONFIRMED),deaths=await this._fetchModel(Type.DEATHS),resolved=await this._fetchModel(Type.RECOVERED);return this.merge(confirmed,deaths,resolved,lookup)}findSeries(timestamp,series){const found=series.find(temp=>temp.timestamp===timestamp);return found?found.value:0}async merge(confirmed,deaths,recovered,lookups){return new Promise(resolve=>{resolve(confirmed.filter(dummy=>"Canada"!==dummy.country||"Recovered"!==dummy.state).map(model=>{const lookup=lookups.find(dummy=>{let ret=dummy.country.localeCompare(model.country);return 0===ret&&(ret=dummy.state.localeCompare(model.state)),0===ret}),modelDeaths=deaths.find(dummy=>dummy.country===model.country&&dummy.state===model.state),modelRecovered=recovered.find(dummy=>dummy.country===model.country&&dummy.state===model.state),values=model.values.map(value=>Object.freeze({confirmed:value.value,deaths:this.findSeries(value.timestamp,modelDeaths?modelDeaths.values:[]),recovered:this.findSeries(value.timestamp,modelRecovered?modelRecovered.values:[]),timestamp:value.timestamp}));return Object.freeze({country:model.country,lat:model.lat,lon:model.lon,state:model.state,population:lookup&&lookup.population||0,values:Object.freeze(values)})}))})}async _fetchModel(type){return this._fetch(type).then(text=>csv2json(text)).then(models=>this._modelMapper.map(models))}async _fetchLookup(){return this._fetch(Type.LOOKUP).then(text=>csv2json(text)).then(models=>this._lookupMapper.map(models))}async _fetch(type){return fetch(this._fetchUrl(type),{headers:this._fetchHeaders(),method:"GET"}).then(response=>response.text())}_fetchHeaders(){return{"Accept-Encoding":"gzip, deflate, br"}}_fetchUrl(type){const base="https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/";return type===Type.LOOKUP?base+"UID_ISO_FIPS_LookUp_Table.csv":`https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_${type}_global.csv`}}new((()=>{class CustomServiceWorker{constructor(service,base="/",cacheUrls=[]){this.service=service,this.base=base,this.cacheUrls=cacheUrls,this.model=[],service.customServiceWorker=this}register(){if(!this.service)throw new Error("Invalid service [ServiceWorkerGlobalScope]");this.service.onactivate=this.onActivate.bind(this),this.service.onfetch=this.onFetch.bind(this),this.service.oninstall=this.onInstall.bind(this),this.service.onmessage=this.onMessage.bind(this)}onActivate(){setTimeout(()=>{this.updateModel()},1500)}onFetch(event){this.log("fetch",event.request.url),"only-if-cached"===event.request.cache&&"same-origin"!==event.request.mode||event.respondWith(caches.match(event.request).then(response=>response||this.service.fetch(event.request,{credentials:"same-origin"}).then(response=>{if(!response||200!==response.status||"basic"!==response.type)return response;const responseToCache=response.clone();return caches.open(this.cacheId("fetch")).then(cache=>{cache.put(event.request,responseToCache)}).catch(error=>{throw error}),response})))}onInstall(event){this.log("install",event),this.initializeCache(event)}onMessage(event){if(event&&event.data&&event.data.type)switch(event.data.type){case"GET_VERSION":console.log("message","GET_VERSION"),event.ports[0].postMessage(CustomServiceWorker.version);break;case"CLIENTS_CLAIM":console.log("message","CLIENTS_CLAIM"),this.service.clients.claim();break;case"SKIP_WAITING":console.log("message","SKIP_WAITING"),this.service.skipWaiting()}else console.log("message",event),this.updateModel()}get installCacheId(){return this.cacheId("install")}log(...parameters){console.log(parameters)}cacheId(id){return`${id}-${CustomServiceWorker.version}`}initializeCache(event){event.waitUntil(caches.open(this.installCacheId).then(cache=>cache.addAll(this.cacheUrls.map(url=>`${this.base}${url}`).concat(["https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/UID_ISO_FIPS_LookUp_Table.csv","https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv","https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_global.csv","https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_recovered_global.csv"]))).then(()=>this.service.skipWaiting()).catch(error=>{throw error}).finally(()=>{console.log(this.service)}))}updateModel(){(new ModelCollector).collect().then(model=>{this.model=model}).catch(e=>{self.postMessage(e)}).finally(()=>{this.service.clients.matchAll().then(clients=>{clients.forEach(client=>{client.postMessage(this.model)})})})}}return CustomServiceWorker.id="ts-covid19 - ServiceWorker",CustomServiceWorker.version="0.0.1",CustomServiceWorker})())(self,new URL(location.toString()).searchParams.get("base")||"/",["/","/es-module-shims.js","/es-modules-shims.json","/favicon.ico","/index.html","/manifest.json","/robots.txt","/serviceWorker.js","/worker.js","/favicon/android-chrome-144x144.png","/favicon/android-chrome-192x192.png","/favicon/android-chrome-256x256.png","/favicon/android-chrome-36x36.png","/favicon/android-chrome-384x384.png","/favicon/android-chrome-48x48.png","/favicon/android-chrome-512x512.png","/favicon/android-chrome-72x72.png","/favicon/android-chrome-96x96.png","/favicon/apple-touch-icon-1024x1024.png","/favicon/apple-touch-icon-114x114.png","/favicon/apple-touch-icon-120x120.png","/favicon/apple-touch-icon-144x144.png","/favicon/apple-touch-icon-152x152.png","/favicon/apple-touch-icon-167x167.png","/favicon/apple-touch-icon-180x180.png","/favicon/apple-touch-icon-57x57.png","/favicon/apple-touch-icon-60x60.png","/favicon/apple-touch-icon-72x72.png","/favicon/apple-touch-icon-76x76.png","/favicon/apple-touch-icon-precomposed.png","/favicon/apple-touch-icon.png","/favicon/favicon-16x16.png","/favicon/favicon-32x32.png","/favicon/favicon-48x48.png","/script/application.js","/script/context.js","/script/index.js","/script/routes.js","/script/components/organisms/countries/countries.js","/script/components/organisms/countries/index.js","/script/components/organisms/world/index.js","/script/components/organisms/world/world.js","/script/components/pages/about/about.js","/script/components/pages/about/index.js","/script/components/pages/home/home.js","/script/components/pages/home/index.js","/script/components/templates/default/index.js","/script/components/templates/default/layout.js","/script/model/index.js","/script/model/model.js","/script/model/population.js","/script/model/processor.js","/vendor/@material-ui/core.js","/vendor/@material-ui/icons.js","/vendor/@material-ui/styles.js","/vendor/clsx/clsx.js","/vendor/prop-types/prop-types.js","/vendor/react/react.js","/vendor/react-dom/react-dom.js","/vendor/react-is/react-is.js","/vendor/react-router/react-router.js","/vendor/react-router-dom/react-router-dom.js","/vendor/react-virtualized/react-virtualized.js","/vendor/recharts/recharts.js"]).register();