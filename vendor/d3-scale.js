import{range as wt,bisect as Mc,tickStep as Ft,ticks as kt,tickIncrement as St,ascending as tt,quantile as Nc,bisector as nt}from"d3-array";import{interpolate as qc,interpolateNumber as Ac,interpolateRound as Dc,piecewise as jr}from"d3-interpolate";import{formatSpecifier as er,precisionFixed as pr,precisionRound as vr,precisionPrefix as gr,formatPrefix as fr,format as ur}from"d3-format";import{timeMillisecond as Ic,timeSecond as Oc,timeMinute as Fc,timeHour as Pc,timeDay as Zr,timeWeek as Lc,timeMonth as Qc,timeYear as Ir,utcMillisecond as Uc,utcSecond as zc,utcMinute as pa,utcHour as xa,utcDay as Ur,utcWeek as Bc,utcMonth as Ra,utcYear as Wr}from"d3-time";import{timeFormat as $r,utcFormat as Gr}from"d3-time-format";function Yc(n,t){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(t).domain(n)}return this}function Hc(n,t){switch(arguments.length){case 0:break;case 1:"function"==typeof n?this.interpolator(n):this.range(n);break;default:this.domain(n),"function"==typeof t?this.interpolator(t):this.range(t)}return this}const Wc=Symbol("implicit");function Gc(){var n=new Map,t=[],r=[],e=Wc;function a(a){var u=a+"",i=n.get(u);if(!i){if(e!==Wc)return e;n.set(u,i=t.push(a))}return r[(i-1)%r.length]}return a.domain=function(r){if(!arguments.length)return t.slice();t=[],n=new Map;for(const e of r){const r=e+"";n.has(r)||n.set(r,t.push(e))}return a},a.range=function(n){return arguments.length?(r=Array.from(n),a):r.slice()},a.unknown=function(n){return arguments.length?(e=n,a):e},a.copy=function(){return Gc(t,r).unknown(e)},Yc.apply(a,arguments),a}function Jc(){var n,t,r=Gc().unknown(void 0),e=r.domain,a=r.range,u=0,i=1,o=!1,c=0,l=0,f=.5;function s(){var r=e().length,s=i<u,h=s?i:u,p=s?u:i;n=(p-h)/Math.max(1,r-c+2*l),o&&(n=Math.floor(n)),h+=(p-h-n*(r-c))*f,t=n*(1-c),o&&(h=Math.round(h),t=Math.round(t));var g=wt(r).map((function(t){return h+n*t}));return a(s?g.reverse():g)}return delete r.unknown,r.domain=function(n){return arguments.length?(e(n),s()):e()},r.range=function(n){return arguments.length?([u,i]=n,u=+u,i=+i,s()):[u,i]},r.rangeRound=function(n){return[u,i]=n,u=+u,i=+i,o=!0,s()},r.bandwidth=function(){return t},r.step=function(){return n},r.round=function(n){return arguments.length?(o=!!n,s()):o},r.padding=function(n){return arguments.length?(c=Math.min(1,l=+n),s()):c},r.paddingInner=function(n){return arguments.length?(c=Math.min(1,n),s()):c},r.paddingOuter=function(n){return arguments.length?(l=+n,s()):l},r.align=function(n){return arguments.length?(f=Math.max(0,Math.min(1,n)),s()):f},r.copy=function(){return Jc(e(),[u,i]).round(o).paddingInner(c).paddingOuter(l).align(f)},Yc.apply(s(),arguments)}function Kc(n){var t=n.copy;return n.padding=n.paddingOuter,delete n.paddingInner,delete n.paddingOuter,n.copy=function(){return Kc(t())},n}function Vc(){return Kc(Jc.apply(null,arguments).paddingInner(1))}function Ot(n){return+n}var Xc=[0,1];function vt(n){return n}function Zc(n,t){return(t-=n=+n)?function(r){return(r-n)/t}:(r=isNaN(t)?NaN:.5,function(){return r});var r}function $c(n,t,r){var e=n[0],a=n[1],u=t[0],i=t[1];return a<e?(e=Zc(a,e),u=r(i,u)):(e=Zc(e,a),u=r(u,i)),function(n){return u(e(n))}}function nf(n,t,r){var e=Math.min(n.length,t.length)-1,a=new Array(e),u=new Array(e),i=-1;for(n[e]<n[0]&&(n=n.slice().reverse(),t=t.slice().reverse());++i<e;)a[i]=Zc(n[i],n[i+1]),u[i]=r(t[i],t[i+1]);return function(t){var r=Mc(n,t,1,e)-1;return u[r](a[r](t))}}function tf(n,t){return t.domain(n.domain()).range(n.range()).interpolate(n.interpolate()).clamp(n.clamp()).unknown(n.unknown())}function rf(){var n,t,r,e,a,u,i=Xc,o=Xc,c=qc,l=vt;function f(){var n,t,r,c=Math.min(i.length,o.length);return l!==vt&&(n=i[0],t=i[c-1],n>t&&(r=n,n=t,t=r),l=function(r){return Math.max(n,Math.min(t,r))}),e=c>2?nf:$c,a=u=null,s}function s(t){return isNaN(t=+t)?r:(a||(a=e(i.map(n),o,c)))(n(l(t)))}return s.invert=function(r){return l(t((u||(u=e(o,i.map(n),Ac)))(r)))},s.domain=function(n){return arguments.length?(i=Array.from(n,Ot),f()):i.slice()},s.range=function(n){return arguments.length?(o=Array.from(n),f()):o.slice()},s.rangeRound=function(n){return o=Array.from(n),c=Dc,f()},s.clamp=function(n){return arguments.length?(l=!!n||vt,f()):l!==vt},s.interpolate=function(n){return arguments.length?(c=n,f()):c},s.unknown=function(n){return arguments.length?(r=n,s):r},function(r,e){return n=r,t=e,f()}}function ef(){return rf()(vt,vt)}function af(n,t,r,e){var a,u=Ft(n,t,r);switch((e=er(null==e?",f":e)).type){case"s":var i=Math.max(Math.abs(n),Math.abs(t));return null!=e.precision||isNaN(a=gr(u,i))||(e.precision=a),fr(e,i);case"":case"e":case"g":case"p":case"r":null!=e.precision||isNaN(a=vr(u,Math.max(Math.abs(n),Math.abs(t))))||(e.precision=a-("e"===e.type));break;case"f":case"%":null!=e.precision||isNaN(a=pr(u))||(e.precision=a-2*("%"===e.type))}return ur(e)}function uf(n){var t=n.domain;return n.ticks=function(n){var r=t();return kt(r[0],r[r.length-1],null==n?10:n)},n.tickFormat=function(n,r){var e=t();return af(e[0],e[e.length-1],null==n?10:n,r)},n.nice=function(r){null==r&&(r=10);var e,a=t(),u=0,i=a.length-1,o=a[u],c=a[i];return c<o&&(e=o,o=c,c=e,e=u,u=i,i=e),(e=St(o,c,r))>0?(o=Math.floor(o/e)*e,c=Math.ceil(c/e)*e,e=St(o,c,r)):e<0&&(o=Math.ceil(o*e)/e,c=Math.floor(c*e)/e,e=St(o,c,r)),e>0?(a[u]=Math.floor(o/e)*e,a[i]=Math.ceil(c/e)*e,t(a)):e<0&&(a[u]=Math.ceil(o*e)/e,a[i]=Math.floor(c*e)/e,t(a)),n},n}function Ln(){var n=ef();return n.copy=function(){return tf(n,Ln())},Yc.apply(n,arguments),uf(n)}function of(n){var t;function r(n){return isNaN(n=+n)?t:n}return r.invert=r,r.domain=r.range=function(t){return arguments.length?(n=Array.from(t,Ot),r):n.slice()},r.unknown=function(n){return arguments.length?(t=n,r):t},r.copy=function(){return of(n).unknown(t)},n=arguments.length?Array.from(n,Ot):[0,1],uf(r)}function cf(n,t){var r,e=0,a=(n=n.slice()).length-1,u=n[e],i=n[a];return i<u&&(r=e,e=a,a=r,r=u,u=i,i=r),n[e]=t.floor(u),n[a]=t.ceil(i),n}function lf(n){return Math.log(n)}function ff(n){return Math.exp(n)}function sf(n){return-Math.log(-n)}function hf(n){return-Math.exp(-n)}function pf(n){return isFinite(n)?+("1e"+n):n<0?0:n}function gf(n){return function(t){return-n(-t)}}function mf(n){var t,r,e=n(lf,ff),a=e.domain,u=10;function i(){return t=function(n){return n===Math.E?Math.log:10===n&&Math.log10||2===n&&Math.log2||(n=Math.log(n),function(t){return Math.log(t)/n})}(u),r=function(n){return 10===n?pf:n===Math.E?Math.exp:function(t){return Math.pow(n,t)}}(u),a()[0]<0?(t=gf(t),r=gf(r),n(sf,hf)):n(lf,ff),e}return e.base=function(n){return arguments.length?(u=+n,i()):u},e.domain=function(n){return arguments.length?(a(n),i()):a()},e.ticks=function(n){var e,i=a(),o=i[0],c=i[i.length-1];(e=c<o)&&(h=o,o=c,c=h);var l,f,s,h=t(o),p=t(c),g=null==n?10:+n,m=[];if(!(u%1)&&p-h<g){if(h=Math.floor(h),p=Math.ceil(p),o>0){for(;h<=p;++h)for(f=1,l=r(h);f<u;++f)if(!((s=l*f)<o)){if(s>c)break;m.push(s)}}else for(;h<=p;++h)for(f=u-1,l=r(h);f>=1;--f)if(!((s=l*f)<o)){if(s>c)break;m.push(s)}2*m.length<g&&(m=kt(o,c,g))}else m=kt(h,p,Math.min(p-h,g)).map(r);return e?m.reverse():m},e.tickFormat=function(n,a){if(null==a&&(a=10===u?".0e":","),"function"!=typeof a&&(a=ur(a)),n===1/0)return a;null==n&&(n=10);var i=Math.max(1,u*n/e.ticks().length);return function(n){var e=n/r(Math.round(t(n)));return e*u<u-.5&&(e*=u),e<=i?a(n):""}},e.nice=function(){return a(cf(a(),{floor:function(n){return r(Math.floor(t(n)))},ceil:function(n){return r(Math.ceil(t(n)))}}))},e}function df(){var n=mf(rf()).domain([1,10]);return n.copy=function(){return tf(n,df()).base(n.base())},Yc.apply(n,arguments),n}function yf(n){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/n))}}function vf(n){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*n}}function Mf(n){var t=1,r=n(yf(t),vf(t));return r.constant=function(r){return arguments.length?n(yf(t=+r),vf(t)):t},uf(r)}function wf(){var n=Mf(rf());return n.copy=function(){return tf(n,wf()).constant(n.constant())},Yc.apply(n,arguments)}function kf(n){return function(t){return t<0?-Math.pow(-t,n):Math.pow(t,n)}}function Nf(n){return n<0?-Math.sqrt(-n):Math.sqrt(n)}function xf(n){return n<0?-n*n:n*n}function bf(n){var t=n(vt,vt),r=1;function e(){return 1===r?n(vt,vt):.5===r?n(Nf,xf):n(kf(r),kf(1/r))}return t.exponent=function(n){return arguments.length?(r=+n,e()):r},uf(t)}function Sf(){var n=bf(rf());return n.copy=function(){return tf(n,Sf()).exponent(n.exponent())},Yc.apply(n,arguments),n}function qf(){return Sf.apply(null,arguments).exponent(.5)}function Af(n){return Math.sign(n)*n*n}function Df(n){return Math.sign(n)*Math.sqrt(Math.abs(n))}function Bt(){var n,t=[],r=[],e=[];function a(){var n=0,a=Math.max(1,r.length);for(e=new Array(a-1);++n<a;)e[n-1]=Nc(t,n/a);return u}function u(t){return isNaN(t=+t)?n:r[Mc(e,t)]}return u.invertExtent=function(n){var a=r.indexOf(n);return a<0?[NaN,NaN]:[a>0?e[a-1]:t[0],a<e.length?e[a]:t[t.length-1]]},u.domain=function(n){if(!arguments.length)return t.slice();t=[];for(let r of n)null==r||isNaN(r=+r)||t.push(r);return t.sort(tt),a()},u.range=function(n){return arguments.length?(r=Array.from(n),a()):r.slice()},u.unknown=function(t){return arguments.length?(n=t,u):n},u.quantiles=function(){return e.slice()},u.copy=function(){return Bt().domain(t).range(r).unknown(n)},Yc.apply(u,arguments)}function qr(){var n,t=0,r=1,e=1,a=[.5],u=[0,1];function i(t){return t<=t?u[Mc(a,t,0,e)]:n}function o(){var n=-1;for(a=new Array(e);++n<e;)a[n]=((n+1)*r-(n-e)*t)/(e+1);return i}return i.domain=function(n){return arguments.length?([t,r]=n,t=+t,r=+r,o()):[t,r]},i.range=function(n){return arguments.length?(e=(u=Array.from(n)).length-1,o()):u.slice()},i.invertExtent=function(n){var i=u.indexOf(n);return i<0?[NaN,NaN]:i<1?[t,a[0]]:i>=e?[a[e-1],r]:[a[i-1],a[i]]},i.unknown=function(t){return arguments.length?(n=t,i):i},i.thresholds=function(){return a.slice()},i.copy=function(){return qr().domain([t,r]).range(u).unknown(n)},Yc.apply(uf(i),arguments)}function If(){var n,t=[.5],r=[0,1],e=1;function a(a){return a<=a?r[Mc(t,a,0,e)]:n}return a.domain=function(n){return arguments.length?(t=Array.from(n),e=Math.min(t.length,r.length-1),a):t.slice()},a.range=function(n){return arguments.length?(r=Array.from(n),e=Math.min(t.length,r.length-1),a):r.slice()},a.invertExtent=function(n){var e=r.indexOf(n);return[t[e-1],t[e]]},a.unknown=function(t){return arguments.length?(n=t,a):n},a.copy=function(){return If().domain(t).range(r).unknown(n)},Yc.apply(a,arguments)}function _n(n){return new Date(n)}function Of(n){return n instanceof Date?+n:+new Date(+n)}function Ff(n,t,r,e,a,u,i,o,c){var l=ef(),f=l.invert,s=l.domain,h=c(".%L"),p=c(":%S"),g=c("%I:%M"),m=c("%I %p"),d=c("%a %d"),y=c("%b %d"),v=c("%B"),M=c("%Y"),w=[[i,1,1e3],[i,5,5e3],[i,15,15e3],[i,30,3e4],[u,1,6e4],[u,5,3e5],[u,15,9e5],[u,30,18e5],[a,1,36e5],[a,3,108e5],[a,6,216e5],[a,12,432e5],[e,1,864e5],[e,2,1728e5],[r,1,6048e5],[t,1,2592e6],[t,3,7776e6],[n,1,31536e6]];function k(o){return(i(o)<o?h:u(o)<o?p:a(o)<o?g:e(o)<o?m:t(o)<o?r(o)<o?d:y:n(o)<o?v:M)(o)}function N(t,r,e){if(null==t&&(t=10),"number"==typeof t){var a,u=Math.abs(e-r)/t,i=nt((function(n){return n[2]})).right(w,u);return i===w.length?(a=Ft(r/31536e6,e/31536e6,t),t=n):i?(a=(i=w[u/w[i-1][2]<w[i][2]/u?i-1:i])[1],t=i[0]):(a=Math.max(Ft(r,e,t),1),t=o),t.every(a)}return t}return l.invert=function(n){return new Date(f(n))},l.domain=function(n){return arguments.length?s(Array.from(n,Of)):s().map(_n)},l.ticks=function(n){var t,r=s(),e=r[0],a=r[r.length-1],u=a<e;return u&&(t=e,e=a,a=t),t=(t=N(n,e,a))?t.range(e,a+1):[],u?t.reverse():t},l.tickFormat=function(n,t){return null==t?k:c(t)},l.nice=function(n){var t=s();return(n=N(n,t[0],t[t.length-1]))?s(cf(t,n)):l},l.copy=function(){return tf(l,Ff(n,t,r,e,a,u,i,o,c))},l}function Pf(){return Yc.apply(Ff(Ir,Qc,Lc,Zr,Pc,Fc,Oc,Ic,$r).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function Rf(){return Yc.apply(Ff(Wr,Ra,Bc,Ur,xa,pa,zc,Uc,Gr).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function Lf(){var n,t,r,e,a,u=0,i=1,o=vt,c=!1;function l(t){return isNaN(t=+t)?a:o(0===r?.5:(t=(e(t)-n)*r,c?Math.max(0,Math.min(1,t)):t))}function f(n){return function(t){var r,e;return arguments.length?([r,e]=t,o=n(r,e),l):[o(0),o(1)]}}return l.domain=function(a){return arguments.length?([u,i]=a,n=e(u=+u),t=e(i=+i),r=n===t?0:1/(t-n),l):[u,i]},l.clamp=function(n){return arguments.length?(c=!!n,l):c},l.interpolator=function(n){return arguments.length?(o=n,l):o},l.range=f(qc),l.rangeRound=f(Dc),l.unknown=function(n){return arguments.length?(a=n,l):a},function(a){return e=a,n=a(u),t=a(i),r=n===t?0:1/(t-n),l}}function Tf(n,t){return t.domain(n.domain()).interpolator(n.interpolator()).clamp(n.clamp()).unknown(n.unknown())}function Ef(){var n=uf(Lf()(vt));return n.copy=function(){return Tf(n,Ef())},Hc.apply(n,arguments)}function Qf(){var n=bf(Lf());return n.copy=function(){return Tf(n,Qf()).exponent(n.exponent())},Hc.apply(n,arguments)}function Uf(){var n,t,r,e,a,u,i,o=0,c=.5,l=1,f=1,s=vt,h=!1;function p(n){return isNaN(n=+n)?i:(n=.5+((n=+u(n))-t)*(f*n<f*t?e:a),s(h?Math.max(0,Math.min(1,n)):n))}function g(n){return function(t){var r,e,a;return arguments.length?([r,e,a]=t,s=jr(n,[r,e,a]),p):[s(0),s(.5),s(1)]}}return p.domain=function(i){return arguments.length?([o,c,l]=i,n=u(o=+o),t=u(c=+c),r=u(l=+l),e=n===t?0:.5/(t-n),a=t===r?0:.5/(r-t),f=t<n?-1:1,p):[o,c,l]},p.clamp=function(n){return arguments.length?(h=!!n,p):h},p.interpolator=function(n){return arguments.length?(s=n,p):s},p.range=g(qc),p.rangeRound=g(Dc),p.unknown=function(n){return arguments.length?(i=n,p):i},function(i){return u=i,n=i(o),t=i(c),r=i(l),e=n===t?0:.5/(t-n),a=t===r?0:.5/(r-t),f=t<n?-1:1,p}}function _f(){var n=uf(Uf()(vt));return n.copy=function(){return Tf(n,_f())},Hc.apply(n,arguments)}function zf(){var n=bf(Uf());return n.copy=function(){return Tf(n,zf()).exponent(n.exponent())},Hc.apply(n,arguments)}var Bf=Object.freeze({__proto__:null,scaleBand:Jc,scalePoint:Vc,scaleIdentity:of,scaleLinear:Ln,scaleLog:df,scaleSymlog:wf,scaleOrdinal:Gc,scaleImplicit:Wc,scalePow:Sf,scaleSqrt:qf,scaleRadial:function n(){var t,r=ef(),e=[0,1],a=!1;function u(n){var e=Df(r(n));return isNaN(e)?t:a?Math.round(e):e}return u.invert=function(n){return r.invert(Af(n))},u.domain=function(n){return arguments.length?(r.domain(n),u):r.domain()},u.range=function(n){return arguments.length?(r.range((e=Array.from(n,Ot)).map(Af)),u):e.slice()},u.rangeRound=function(n){return u.range(n).round(!0)},u.round=function(n){return arguments.length?(a=!!n,u):a},u.clamp=function(n){return arguments.length?(r.clamp(n),u):r.clamp()},u.unknown=function(n){return arguments.length?(t=n,u):t},u.copy=function(){return n(r.domain(),e).round(a).clamp(r.clamp()).unknown(t)},Yc.apply(u,arguments),uf(u)},scaleQuantile:Bt,scaleQuantize:qr,scaleThreshold:If,scaleTime:Pf,scaleUtc:Rf,scaleSequential:Ef,scaleSequentialLog:function n(){var t=mf(Lf()).domain([1,10]);return t.copy=function(){return Tf(t,n()).base(t.base())},Hc.apply(t,arguments)},scaleSequentialPow:Qf,scaleSequentialSqrt:function(){return Qf.apply(null,arguments).exponent(.5)},scaleSequentialSymlog:function n(){var t=Mf(Lf());return t.copy=function(){return Tf(t,n()).constant(t.constant())},Hc.apply(t,arguments)},scaleSequentialQuantile:function n(){var t=[],r=vt;function e(n){if(!isNaN(n=+n))return r((Mc(t,n,1)-1)/(t.length-1))}return e.domain=function(n){if(!arguments.length)return t.slice();t=[];for(let r of n)null==r||isNaN(r=+r)||t.push(r);return t.sort(tt),e},e.interpolator=function(n){return arguments.length?(r=n,e):r},e.range=function(){return t.map((n,e)=>r(e/(t.length-1)))},e.quantiles=function(n){return Array.from({length:n+1},(r,e)=>Nc(t,e/n))},e.copy=function(){return n(r).domain(t)},Hc.apply(e,arguments)},scaleDiverging:_f,scaleDivergingLog:function n(){var t=mf(Uf()).domain([.1,1,10]);return t.copy=function(){return Tf(t,n()).base(t.base())},Hc.apply(t,arguments)},scaleDivergingPow:zf,scaleDivergingSqrt:function(){return zf.apply(null,arguments).exponent(.5)},scaleDivergingSymlog:function n(){var t=Mf(Uf());return t.copy=function(){return Tf(t,n()).constant(t.constant())},Hc.apply(t,arguments)},tickFormat:af});export default Bf;export{Bf as d3Scale,Jc as scaleBand,_f as scaleDiverging,of as scaleIdentity,Wc as scaleImplicit,Ln as scaleLinear,df as scaleLog,Gc as scaleOrdinal,Vc as scalePoint,Sf as scalePow,Bt as scaleQuantile,qr as scaleQuantize,Ef as scaleSequential,qf as scaleSqrt,wf as scaleSymlog,If as scaleThreshold,Pf as scaleTime,Rf as scaleUtc};